:root{
  --bg:#0f1226; --panel:#171a35; --accent:#c6a769; --accent-2:#8ad1ff; --text:#e9ecff; --muted:#aab2d6;
  --card-border:#2b2f55; --shadow:0 10px 30px rgba(0,0,0,.35);
  --header-h:72px;
}

/* Kompensacja sticky headera przy przewijaniu/anchorach */
html{ scroll-padding-top: calc(var(--header-h) + 8px); }

html,body{height:100%}
body{
  margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial;
  color:var(--text);
  background:radial-gradient(1200px 800px at 80% -10%, #1b1f47 0%, #0f1226 60%, #0b0e22 100%);
  display:flex; flex-direction:column; gap:16px
}

header{
  position:sticky; top:0; z-index:10;
  backdrop-filter:blur(8px);
  background:linear-gradient(180deg, rgba(15,18,38,.9) 0%, rgba(15,18,38,.5) 100%);
  border-bottom:1px solid #1e2143; box-shadow:var(--shadow);
  transition: transform .25s ease; will-change: transform;
}
body.scrolldown header{ transform: translateY(-100%); }
body:not(.scrolldown) header{ box-shadow: 0 8px 18px rgba(0,0,0,.25); }

.wrap{ max-width:1200px; margin:0 auto; padding:16px }
h1{ font-size:clamp(22px,3vw,28px); letter-spacing:.5px; display:flex; align-items:center; gap:10px; margin:0 0 10px }
.logo{ width:28px; height:28px; border-radius:6px; background:conic-gradient(from 0deg,#c6a769,#8ad1ff,#c6a769); box-shadow:0 0 10px rgba(198,167,105,.5) inset }

.controls{ display:flex; flex-wrap:wrap; gap:10px; align-items:center }
select,button,input[type="checkbox"]+label{ font:inherit }
select,button{ background:#121537; border:1px solid var(--card-border); color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer; transition:.2s; box-shadow:var(--shadow) }
select:focus,button:focus{ outline:2px solid var(--accent-2) }
button:hover,.filebtn:hover{ transform:translateY(-1px) }
button.accent{ background:linear-gradient(180deg,#2b2f55,#20244b) }
button.primary{ background:linear-gradient(180deg,#c6a769,#b8924a); color:#0b0e22; font-weight:600 }
button.ghost{ background:transparent }
.checkbox{ display:flex; align-items:center; gap:8px; padding:6px 10px; background:#121537; border:1px solid var(--card-border); border-radius:12px }
.filebtn{ background:#121537; border:1px solid var(--card-border); color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer; box-shadow:var(--shadow) }
.muted{ color:var(--muted); font-size:12px; margin-left:4px }
button, .filebtn{ touch-action: manipulation; }

main{ display:grid; grid-template-columns:1.2fr .8fr; gap:18px; align-items:start }
@media (max-width:920px){ main{ grid-template-columns:1fr } }

/* --- KARTY: rosną z treścią, bez efektu 3D --- */
#board{
  display:grid; gap:14px;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  grid-auto-rows:auto; align-items:start;
  padding:12px; border:1px dashed var(--card-border); border-radius:16px;
  background:rgba(18,21,55,.45);
  scroll-margin-top: calc(var(--header-h) + 8px);
}
.card{ position:relative; user-select:none; cursor:pointer; border-radius:16px; height:auto; scroll-margin-top: calc(var(--header-h) + 8px); }
.face{ border-radius:16px; overflow:hidden; border:1px solid var(--card-border); box-shadow:var(--shadow); background:linear-gradient(180deg,#15183a,#0e1030); margin:0 }
.front .name{ padding:10px 12px; font-weight:600; border-bottom:1px solid #242859; color:#ffecb3; background:linear-gradient(180deg,#1b1f47,#121537) }
.front .img{ width:100%; aspect-ratio:3/5; display:grid; place-items:center; background:radial-gradient(140px 100px at 60% 0%, rgba(138,209,255,.08), transparent 70%) }
.front .img img{ width:100%; height:100%; object-fit:cover; display:block }
.fit-contain .front .img img{ object-fit:contain } /* przełącznik F */
.front .img.no-art{ background:repeating-linear-gradient(45deg, rgba(138,209,255,.08) 0 8px, rgba(138,209,255,.03) 8px 16px), linear-gradient(180deg,#0f1230,#0a0d24) }
.front .body{ padding:12px; font-size:13px; line-height:1.5 }
.front .body .kw{ color:var(--muted); font-size:12px }
.front .footer{ padding:10px 12px; border-top:1px solid #242859; font-size:12px; color:#8ad1ff; display:flex; justify-content:space-between; align-items:center }

.back{
  background:radial-gradient(200px 100px at 80% -10%, rgba(198,167,105,.15) 0%, rgba(198,167,105,0) 65%), linear-gradient(180deg,#101334,#090b21);
  display:grid; place-items:center; position:relative; min-height:220px
}
.back::before{ content:""; position:absolute; inset:8px; border-radius:12px; border:1px dashed #3a3f78 }
.pos-index{ position:absolute; top:6px; left:6px; font-size:11px; opacity:.8; background:#14173a; border:1px solid var(--card-border); padding:3px 7px; border-radius:999px; color:#8ad1ff }
.rev{ position:absolute; top:6px; right:6px; font-size:11px; padding:3px 7px; border-radius:999px; border:1px solid #3a3f78; background:#14173a; color:#8ad1ff }
.sigil{ width:64px; height:64px; border-radius:50%; display:grid; place-items:center; box-shadow:inset 0 0 0 2px rgba(138,209,255,.35), 0 0 25px rgba(138,209,255,.2); color:#8ad1ff }

/* przełączanie stron karty */
.card[data-revealed="true"] .front{ display:block }
.card[data-revealed="true"] .back{ display:none }
.card:not([data-revealed="true"]) .front{ display:none }
.card:not([data-revealed="true"]) .back{ display:grid }

/* Panel boczny */
aside{ background:linear-gradient(180deg,#15183a,#0f1230); border:1px solid #242859; border-radius:16px; padding:14px; box-shadow:var(--shadow) }
aside h2{ margin:6px 0 10px; font-size:18px }
.reading-head{ display:flex; align-items:center; justify-content:space-between; gap:8px }
.reading-list{ display:flex; flex-direction:column; gap:12px; margin:12px 0; max-height:60vh; overflow:auto; padding-right:6px }
.reading-item{ background:#121537; border:1px solid #242859; border-radius:12px; padding:10px }
.reading-item .kicker{ font-size:12px; color:#8ad1ff; margin-bottom:6px }
.reading-item .title{ font-weight:700; color:#ffecb3 }
.reading-item .meta{ font-size:12px; color:#aab2d6; margin-top:4px }
.reading-item{ scroll-margin-top: calc(var(--header-h) + 8px); }

/* Panel: Szczegóły talii */
.deckinfo{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; z-index:9999; padding:20px }
.deckinfo.show{ display:block }
.deckinfo .panel{
  max-width:960px; margin:0 auto; background:linear-gradient(180deg,#15183a,#0f1230);
  border:1px solid #242859; border-radius:16px; padding:16px; box-shadow:var(--shadow);
  max-height:90vh; overflow:auto
}
.deckinfo .head{ display:flex; justify-content:space-between; align-items:center; gap:8px }
.deckinfo .summary{ color:var(--muted); margin:8px 0 12px }
.deckinfo .filters{ display:flex; gap:12px; margin-bottom:10px; font-size:14px }
.deckinfo .list{ display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:8px }
.deckinfo .cardrow{ background:#121537; border:1px solid #242859; border-radius:10px; padding:8px }
.cardrow .src{ font-size:12px; color:#8ad1ff }
.cardrow .title{ font-weight:600; color:#ffecb3 }

/* Dostępność */
.sr-only{ position:absolute; clip:rect(0 0 0 0); clip-path: inset(50%); width:1px; height:1px; overflow:hidden; white-space:nowrap; border:0; padding:0; margin:-1px }

/* Mobile tweaks */
@media (max-width: 600px){
  #board{ grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); }
  .front .name{ font-size:14px }
  .front .body{ font-size:12px; line-height:1.45 }
  .reading-list{ max-height: none }          /* bez wewnętrznego scrolla na mobile */
  header .controls{ gap:8px }
  button, select, .filebtn{ width:100%; padding:12px 14px; border-radius:14px }
}

/* Bardzo małe ekrany */
@media (max-width: 380px){
  #board{ grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap:10px }
  .wrap{ padding:12px }
  .front .body{ font-size:11.5px }
}